\chapter{Motor}
%vorstellen was in diesem Kapitel gesagt werden soll
%oder eher erklären bsp. Regeln von Motor von EEROS

%\section*{Stichworte}
%\begin{itemize}
%\item überblick (zusammen mit EEROS)
%\item Aufbau urdf
%\item verwendung von urdf
%\item gazebo plugins
%\item joint state publisher
%\item rqt plugins
%\end{itemize}

In diesem Kapitel wird anhand eines einfachen Fallbeispiels gezeigt, wie mit \textit{ROS} die Entwicklung einer \textit{EEROS} Applikation unterstützt werden kann. 
Das Fallbeispiel ist eine Motor"=Baugruppe (Abbildung \ref{Ab:motor-baugruppe}).

Für dieses System muss im \textit{EEROS} ein Regler entwickelt werden.
Um die Entwicklung zu unterstützen und den Regler zu testen, wird eine Simulation erstellt.
Und mit Plots von den Stell"= und Regel"=Grössen kann die Leistung des Reglers besser beurteilt werden.
%Und um die Leistung des Reglers besser beurteilen zu können werden Stell"= und Regel"=Grössen in Plots dargestellt.

%Darum braucht es eine Simulation der Motor"=Baugruppe mit der der Regler getestet werden kann.
%Und auch eine Visualisierung mit der das Verhalten des Regler in einem Plot dargestellt werden kann.

%In diesem Kapitel wird anhand eines einfachen Fallbeispiels gezeigt, wie eine Simulation in Gazebo erstellt wird.
Durch das einfache Beispiel können alle Grundlagen vorgestellt werden, die es braucht um eine Simulation und Visualisierungen erstellen zu können.
%Ein Motor-Baugruppe (Abbildung \ref{Ab:motor-baugruppe}) soll als einfache Beispiel dienen.


\begin{figure}[ht!]
	\centering
	\includegraphics[width=14.5cm]{images/motor_baugruppe.png} %TODO anpassen
	\caption{schematische Darstellung von Motor-Baugruppe}
	\label{Ab:motor-baugruppe}
\end{figure}

\section{Motor"=Baugruppe}
Die Baugruppe besteht aus einem Motor, Schwungrad und linearen Dämpfer.
Diese drei Komponenten sind mit einander verbunden.
Der lineare Dämpfer ist realisiert durch einen zweiten kurzgeschlossenen Motor.

Die Parameter für das Simulations"=Model konnten grössten teils aus den Datenblättern der jeweiligen Komponenten entnommen werden. 
Die Dämpfungskonstante und die Rotationsträgheit der Schwungscheibe mussten berechnet werden.
Die Datenblätter und Berechnungen sind im Repository \textit{\textsc{"}motor\_sim\textit{"}} \footnote{\url{https://github.com/manuelilg/motor\_sim/tree/master/motor\_description/datasheets}} zu finden. 

Für Parameter die nicht im Datenblatt stehen oder nicht genügend Informationen für eine Berechnung vorhanden ist, wurden geschätzt.
Jedoch haben die geschätzten Parameter in diesem Fallbeispiel keinen nennenswerten Einfluss auf die Simulation.
%Somit haben wir folgende Werte die für die physikalische Beschreibung des Modells.
%Für jeden Link müssen immer die Masse und der Trägheits-tensor definiter sein. Dabei darf die Masse nicht 0 sein und 


\section{Modell}
Für die Motorbaugruppe wurde eine Modell"=Beschreibung im \textit{URDF}"=Format erstellt.
Die Kinematische Struktur des Modells ist in der Abbildung xx dargestellt.
Wie zu sehen ist, das der Dämpfer noch nicht mit dem Schwungrad verbunden ist, dieser Umstand wird im Kapitel \ref{chap:kin-schliessen} erläutert.

\begin{figure}[ht!]
	\centering
\begin{tikzpicture}[scale=1,node distance=10mm,
	link/.style={rectangle, draw=black, thick, inner sep=7},
	joint/.style={ellipse, draw=blue, thick},
	>=latex]
 	
 \node[link] (base) {base\_link};
 \node[joint, above right=of base, xshift=70] (mAxis) {motor\_axis};
 \node[joint, above left=of base, xshift=-70, yshift=-3] (dAxis) {damper\_axis};
 \node[link, above=of mAxis] (motor) {motor};
 \node[link, above=of dAxis] (damper) {damper};
 \node[joint, left=of motor] (coupling) {coupling};
 \node[link, left=of coupling] (flywheel) {flywheel};
 
 \path[->, thick, out=0, in=-130]
 	(base) edge (mAxis);
 \path[->, thick]	
 	(mAxis) edge (motor)
 	(motor) edge (coupling)
 	(coupling) edge (flywheel);
 	
 \path[->, thick, out=180, in=-30]
 	(base) edge (dAxis);
 \path[->, thick]
 	(dAxis) edge (damper);

\end{tikzpicture}
	\caption{kinematische Struktur Motor}
	\label{Ab:motor-struktur}
\end{figure}

Die komplette Datei ist im Repositiory \textit{\textsc{"}motor\_sim\textit{"}} \footnote{\url{https://github.com/manuelilg/motor_sim/tree/master/motor_description/urdf}} abgelegt.

%TODO ref auf joint, link

\subsection{Kinematische Kette schliessen}
\label{chap:kin-schliessen}
Das \textit{URDF}"=Format kann keine geschlossenen kinematischen Strukturen abbilden.
Dieser Mangel kann aber behoben werden mit: einem \textit{SDF}"=Joint Eintrag im \textit{URDF} und mit dem \textit{URDF}"=Spezial"=Element \textsc{"}Mimic\textsc{"}.

\subsubsection{SDF"=Joint}
Die in diesem Abschnitt erklärte Anpassung wird benötigt, damit in der Simulation das Schwungrad und der Dämpfer miteinander gekoppelt sind.

Im \textit{URDF} können Informationen hinterlegt werden, die nur \textit{Gazebo} interpretiert.
Dafür müssen die Informationen mit dem XML"=Element \textsc{"}gazebo\textsc{"} umschlossen werden.

Wenn man jetzt ein Joint"=Element im \textit{SDF}"=Format einsetzt kann man die kinematische Struktur schliessen.
Denn die {URDF}"=Datei wird, bevor es ins \textit{Gazebo} geladen wird, ins \textit{SDF}"=Format konvertiert.
Während der Konvertierung werden die Zeilen die sich im XML"=Element \textsc{"}gazebo\textsc{"} befinden einfach ins \textit{SDF} übernommen.

Wie der Eintrag für die Motor"=Baugruppe lauten muss, ist in Auflistung xx gezeigt.

\subsubsection{Mimic}
Der \textit{ROS}"=Knoten \textit{robot\_state\_publisher} berechnet die Transformations"=Daten für die Darstellung der Körper im \textit{RViz}.
Dafür braucht er alle Gelenkwinkel.
Das Modell vom \textit{URDF} hat zwei Gelenke aber das in der Simulation nur eines.
Da in der Simulation die beiden Gelenke verbunden wurden.

Deshalb muss im Gelenk folgender Eintrag eingefügt werden: %TODO joint name
%TODO listing mimic

Dieser Eintrag wird vom \textit{ROS}"=Knoten \textit{joint\_state\_publisher} interpretiert.
Er bewirkt das das Gelenk xx der gleiche Winkel hat wie das Gelenk xx.
Somit erhalten wir vom \textit{joint\_state\_publisher} für die Eingabe von einem Gelenkwinkel xx, die Ausgabe für die Gelenkwinkel xx und xx.

Diese beiden werden dann vom \textit{robot\_state\_publisher} als Eingabe benötigt.

\subsection{Gazebo Plugins}
Damit das Modell in der Simulation mit dem \textit{ROS}"=Netzwerk interagieren kann, müssen Plugins eingesetzt werden.

Mit Folgenden Zeilen werden zwei \textit{Gazebo}"=Plugins im Motor"=Modell eingebettet:
%TODO listing

Das Plugin xx publisht den Winkel von Gelenk xx.
Achtung das Gazebo"=Plugin xx ist nicht mit dem ROS"=Knoten xx zu verwechseln.
Es ist aus dem Package xx, ein Standard \textit{ROS}"=Package.

Das zweite Plugin xx wird im Abschnitt \ref{chap:joint-force-plugin} genauer erläutert.

\subsubsection{Joint Force Plugin}
\label{chap:joint-force-plugin}
Das Plugin xx appliziert ein Drehmoment auf das Gelenk xx.
Die Grösse des Drehmoments erhält das Plugin über das Topic xx.
Dieses Plugin würde im Rahmen dieser Arbeit erstellt und ist im Repository xx zu finden. 


joint force vorstellen

auf tutorial verweisen

es wird vor jedem Simulations"=Schritt aufgerufen

sync erklären

Fälle von Einsatz: 2 oder 3. auch noch

wie benutzen 


\section{•}


\section{rviz}
system wird geladen mit robot description
braucht auch tf

\subsection{Joint State Publisher}
erklären für was gebraucht wird
für mimic tag
Achtung ist eine eigenständiger Knoten


\section{rqt}
keine speziellen anpassungen an urdf 

\section{Starten}
einzelnen programme gazebo, rviz, rqt


